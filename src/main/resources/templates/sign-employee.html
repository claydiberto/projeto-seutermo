<!DOCTYPE html>
<html lang="pt-br" xmlns:th="https://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<title>Employee signature</title>
	<div th:replace="fragments :: sign"></div>
	<script>
		$(document).ready(function () {
			$('#myCanvas').sign({
				resetButton: $('#resetSign'),
				lineWidth: 5
			});
		});
	</script>
	<style>
		#myCanvas {
			border: 2px solid #444;
			border-radius: 10px;
		}
	</style>
</head>

<body>

	<canvas id="myCanvas"></canvas>
	<div>
		<button value="Reset" id='resetSign'>Limpar</button>
		<button type="button" id="saveImage">Save image</button>
	</div>

	<div>
		<form th:action="@{/saveSignEmployee}" th:object="${term}" method="post" enctype="multipart/form-data">

			<div class="form-group">
				<image id="imgConverted" class="form-control-file" />
			</div>

			<div class="form-group">
				<input type="file" name="file" class="form-control-file" id="inputFile">
			</div>

			<button type="submit" class="btn btn-primary">SAVE</button>

			<hr />
			<input type="hidden" th:field="*{id}" />
			<input type="hidden" th:field="*{analyst}" />
			<input type="hidden" th:field="*{employee}" />
			<input type="hidden" th:field="*{employeeSubscription}" id="imgInput" />
		</form>
	</div>

	<script>
		const btnSaveImage = document.querySelector('#saveImage');
		const imgConverted = document.querySelector('#imgConverted');
		const inputFile = document.querySelector('#inputFile');
		const imgInput = document.querySelector('#imgInput');

		let canvas, ctx, dataURI, teste;

		btnSaveImage.addEventListener("click", function () {
			canvas = document.getElementById("myCanvas");
			ctx = canvas.getContext('2d');
			dataURI = canvas.toDataURL("img.png");
			imgConverted.src = dataURI;
			
			//testes

			teste = canvas.toDataURL().split(",")[1];
			console.log(teste);
			
			imgInput.value = teste;

		});

	</script>

</body>

</html>